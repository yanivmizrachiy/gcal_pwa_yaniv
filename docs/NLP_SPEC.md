# מפרט NLP v1 - עיבוד שפה טבעית עברית

## סקירה כללית
מנתח שפה טבעית (NLP) לעברית המאפשר יצירת אירועים ביומן באמצעות משפטים פשוטים בעברית.  
הגרסה הנוכחית (v1) תומכת בזיהוי תאריכים, שעות, צבעים וכותרות אירועים.

## שימוש

### API Endpoint
```
POST https://script.google.com/.../exec
Content-Type: application/json

{
  "action": "text",
  "text": "פגישה עם לקוח מחר 14:00–15:30 צבע אדום",
  "execute": true
}
```

### פרמטרים
- **action**: `"text"` (חובה)
- **text**: המשפט בעברית לפענוח (חובה)
- **execute**: `true` ליצירת האירוע, `false` לפענוח בלבד (אופציונלי, ברירת מחדל: false)

### תשובה
```json
{
  "ok": true,
  "message": "אירוע נוצר בהצלחה מטקסט: פגישה עם לקוח",
  "parsed": {
    "title": "פגישה עם לקוח",
    "start": "2024-01-16T14:00:00.000Z",
    "end": "2024-01-16T15:30:00.000Z",
    "color": "4",
    "description": ""
  },
  "event": {
    "id": "...",
    "title": "פגישה עם לקוח",
    "start": "2024-01-16T14:00:00.000Z",
    "end": "2024-01-16T15:30:00.000Z"
  }
}
```

## תחביר נתמך

### 1. הפניות תאריך (Date References)

#### **היום**
```
"פגישה היום"
→ תאריך: היום
```

#### **מחר**
```
"ארוחת צהריים מחר"
→ תאריך: מחר
```

#### **ימי שבוע + "הבא"**
```
"ישיבת צוות ראשון הבא"
"פגישה שני הבא"
"ארוע רביעי הבא"
```

ימי שבוע נתמכים:
- **ראשון** (יום ראשון)
- **שני** (יום שני)
- **שלישי** (יום שלישי)
- **רביעי** (יום רביעי)
- **חמישי** (יום חמישי)
- **שישי** (יום שישי)
- **שבת** (שבת)

⚠️ **הערה**: יש לציין "הבא" אחרי יום השבוע. ללא "הבא", המילה תיחשב ככותרת.

### 2. טווחי זמן (Time Ranges)

#### **פורמט**: `HH:MM–HH:MM` או `HH:MM-HH:MM`
```
"פגישה 09:00–10:30"
"אירוע 14:00-16:00"
```

#### **שעה בודדת**
אם מצוינת רק שעת התחלה, משך ברירת המחדל הוא שעה אחת:
```
"פגישה 10:00"
→ התחלה: 10:00, סיום: 11:00
```

#### **ללא שעה**
אם לא מצוין זמן, ברירת המחדל היא 09:00–10:00:
```
"פגישה היום"
→ התחלה: היום 09:00, סיום: היום 10:00
```

### 3. צבעים (Colors)

#### **תחביר**: `צבע [שם_צבע]`
```
"פגישה מחר 10:00 צבע אדום"
"ארוחת צהריים צבע ירוק"
```

#### צבעים נתמכים:
| שם עברי | Google Calendar Color ID |
|---------|--------------------------|
| אדום    | RED (4)                  |
| כחול    | BLUE (9)                 |
| ירוק    | GREEN (2)                |
| צהוב    | YELLOW (5)               |
| כתום    | ORANGE (6)               |
| סגול    | PALE_BLUE (3)            |
| ורוד    | PALE_RED (4)             |

⚠️ **הערה**: יש לכתוב "צבע" לפני שם הצבע.

### 4. כותרת האירוע (Event Title)

כל המילים שלא זוהו כתאריך, זמן או צבע נחשבות לכותרת האירוע:
```
"פגישה חשובה עם מנכ״ל מחר 15:00"
→ כותרת: "פגישה חשובה עם מנכ״ל"

"ישיבת סטטוס שני הבא 10:00–11:00"
→ כותרת: "ישיבת סטטוס"
```

## דוגמאות מלאות

### דוגמה 1: פשוט
```
Input: "פגישה היום 14:00"
Output:
  כותרת: "פגישה"
  תאריך: היום
  זמן: 14:00–15:00
```

### דוגמה 2: עם טווח שעות
```
Input: "ארוחת צהריים מחר 13:00–14:30"
Output:
  כותרת: "ארוחת צהריים"
  תאריך: מחר
  זמן: 13:00–14:30
```

### דוגמה 3: עם צבע
```
Input: "פגישה דחופה רביעי הבא 09:00–10:00 צבע אדום"
Output:
  כותרת: "פגישה דחופה"
  תאריך: רביעי הבא
  זמן: 09:00–10:00
  צבע: אדום (RED)
```

### דוגמה 4: כותרת ארוכה
```
Input: "ישיבת תכנון רבעון ראשון עם צוות המכירות שני הבא 15:00"
Output:
  כותרת: "ישיבת תכנון רבעון ראשון עם צוות המכירות"
  תאריך: שני הבא
  זמן: 15:00–16:00
```

### דוגמה 5: מינימלי
```
Input: "פגישה"
Output:
  כותרת: "פגישה"
  תאריך: היום
  זמן: 09:00–10:00 (ברירת מחדל)
```

## מגבלות ידועות

### גרסה נוכחית (v1)
1. **אין תמיכה בתאריכים מוחלטים**: לא ניתן להזין "15/01/2024"
2. **אין תמיכה בביטויים מורכבים**: לא ניתן "בעוד שבוע" או "בשבוע הבא"
3. **אין תמיכה באירועים חוזרים**: לא ניתן "כל יום ראשון"
4. **רגיש לסדר**: מומלץ סדר: כותרת → תאריך → שעה → צבע
5. **מילות קישור לא נתמכות**: "ב-", "ה-" עלולות לבלבל את המנתח

### הערות שימוש
- **הקפד על רווחים**: `"14:00–15:00"` (לא `"14:00–15:00"` ללא רווח)
- **אין חובה לפסיקים או נקודות**
- **אין הבדלה בין אותיות גדולות וקטנות**

## שיפורים מתוכננים (NLP v2)

ראה `NLP_V2_DRAFT.md` לפרטים מלאים. עיקרי השיפורים:
1. תאריכים מוחלטים (15/01, 15 בינואר)
2. ביטויים יחסיים (בעוד שבוע, בחודש הבא)
3. זמנים יחסיים (בבוקר, אחר הצהריים, ערב)
4. תמיכה בקידומות ("ב-", "ה-", "של")
5. תמיכה באירועים חוזרים בסיסית

## Troubleshooting

### "לא נמצאה כותרת לאירוע"
**גורם**: כל המילים במשפט זוהו כמילות מפתח (תאריך/זמן/צבע)  
**פתרון**: הוסף לפחות מילה אחת לכותרת

### "אירוע נוצר בזמן לא נכון"
**גורם אפשרי**:
- פורמט שעה שגוי (צריך `HH:MM`)
- חסר מפריד `-` או `–` בין שעות
**פתרון**: ודא פורמט נכון: `"14:00–15:30"`

### "צבע לא הוחל"
**גורם**: חסרה המילה "צבע" לפני שם הצבע  
**פתרון**: `"... צבע אדום"` (לא רק `"... אדום"`)

## טיפים לשימוש מיטבי

### ✅ מומלץ
```
"פגישה עם לקוח מחר 14:00–15:30 צבע כחול"
"ארוחת צהריים היום 13:00"
"ישיבת סטטוס שני הבא 10:00–11:00"
```

### ❌ לא מומלץ
```
"פגישה בשעה 14:00 ביום מחר"  // סדר לא טוב
"14:00 פגישה"  // שעה לפני כותרת
"פגישה אדום 14:00"  // חסר "צבע"
```

---

**גרסה**: NLP v1  
**תאריך עדכון**: 2024  
**מתחזק**: Yaniv

לשאלות או הצעות לשיפור, פתח Issue בריפוזיטורי.
