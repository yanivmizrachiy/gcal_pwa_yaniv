# תיעוד API - מערכת יומן חכם

## סקירה כללית
המערכת מספקת API מלא לניהול אירועי Google Calendar עם תמיכה בעברית ו-NLP (Natural Language Processing).

## הרשאות נדרשות
- `https://www.googleapis.com/auth/calendar` - גישה מלאה ליומן
- `https://www.googleapis.com/auth/script.external_request` - בקשות חיצוניות
- `https://www.googleapis.com/auth/userinfo.email` - זיהוי משתמש

## נקודות קצה (Endpoints)

### GET Requests

#### 1. בדיקת מערכת
```
GET ?mode=selftest
```
**תגובה:**
```json
{
  "ok": true,
  "now": "2024-01-15T10:30:00.000Z",
  "user": "user@example.com"
}
```

#### 2. שליפת אירועים
```
GET ?mode=events
```
**תגובה:**
```json
{
  "count": 5,
  "events": [
    {
      "id": "event_id_123",
      "title": "פגישה עם דני",
      "start": "2024-01-15T10:00:00.000Z",
      "end": "2024-01-15T11:00:00.000Z",
      "allDay": false,
      "location": "משרד",
      "description": "דיון בפרויקט",
      "color": ""
    }
  ]
}
```

### POST Requests

כל בקשות POST צריכות להיות בפורמט JSON:

```json
{
  "command": "טקסט הפקודה בעברית",
  "action": "סוג הפעולה (אופציונלי)",
  "...פרמטרים נוספים..."
}
```

## פעולות נתמכות

### 1. יצירת אירוע (CREATE)

**דוגמאות פקודות:**
- "צור אירוע פגישה עם דני מחר בשעה 10:00"
- "הוסף פגישה 'דיון בפרויקט' ב-15/01/2024 בשעה 14:00"
- "צור אירוע כל היום טיול ביום שישי"

**פרמטרים נתמכים:**
```json
{
  "command": "צור אירוע פגישה עם דני מחר בשעה 10:00 צבע כחול",
  "title": "פגישה עם דני",
  "startTime": "2024-01-16T10:00:00.000Z",
  "endTime": "2024-01-16T11:00:00.000Z",
  "location": "משרד",
  "color": "כחול",
  "reminders": [15, 30],
  "guests": ["dani@example.com"],
  "description": "תיאור האירוע",
  "allDay": false
}
```

**תגובה מוצלחת:**
```json
{
  "success": true,
  "message": "האירוע 'פגישה עם דני' נוצר בהצלחה ב-שני 16/1/2024 בשעה 10:00, צבע כחול, תזכורות: 15, 30 דקות",
  "eventId": "event_id_123"
}
```

### 2. עדכון אירוע (UPDATE)

**דוגמאות פקודות:**
- "עדכן את האירוע 'פגישה עם דני' לשעה 11:00"
- "שנה את האירוע פגישה למחר"
- "ערוך את האירוע צבע אדום"

**פרמטרים:**
```json
{
  "command": "עדכן את האירוע פגישה עם דני",
  "eventId": "event_id_123",
  "searchTitle": "פגישה עם דני",
  "title": "כותרת חדשה",
  "startTime": "2024-01-16T11:00:00.000Z",
  "color": "אדום"
}
```

### 3. מחיקת אירוע (DELETE)

**דוגמאות פקודות:**
- "מחק את האירוע 'פגישה עם דני'"
- "הסר את האירוע מחר בשעה 10"
- "בטל את הפגישה"

**פרמטרים:**
```json
{
  "command": "מחק את האירוע פגישה עם דני",
  "eventId": "event_id_123",
  "searchTitle": "פגישה עם דני"
}
```

### 4. העברת אירוע (MOVE)

**דוגמאות פקודות:**
- "העבר את האירוע 'פגישה עם דני' למחר"
- "דחה את הפגישה ליום חמישי"
- "הזז את האירוע לשעה 15:00"

**פרמטרים:**
```json
{
  "command": "העבר את האירוע פגישה עם דני למחר בשעה 14:00",
  "eventId": "event_id_123",
  "startTime": "2024-01-16T14:00:00.000Z"
}
```

### 5. שכפול אירוע (DUPLICATE)

**דוגמאות פקודות:**
- "שכפל את האירוע 'פגישה עם דני'"
- "העתק את הפגישה לשבוע הבא"
- "צור עותק של האירוע"

**פרמטרים:**
```json
{
  "command": "שכפל את האירוע פגישה עם דני לשבוע הבא",
  "eventId": "event_id_123",
  "startTime": "2024-01-23T10:00:00.000Z"
}
```

### 6. שינוי צבע (CHANGE_COLOR)

**צבעים זמינים:**
- כחול, ירוק, אדום, כתום, סגול, צהוב, אפור, ורוד, טורקיז, ירוק בהיר

**דוגמאות פקודות:**
- "שנה את צבע האירוע 'פגישה עם דני' לכחול"
- "צבע את הפגישה אדום"

### 7. הוספת תזכורת (ADD_REMINDER)

**דוגמאות פקודות:**
- "הוסף תזכורת 15 דקות לאירוע 'פגישה עם דני'"
- "תזכיר לי חצי שעה לפני הפגישה"
- "הוסף תזכורת רבע שעה"

**פרמטרים:**
```json
{
  "command": "הוסף תזכורת 15 דקות",
  "eventId": "event_id_123",
  "reminders": [15, 30]
}
```

### 8. הוספת משתתפים (ADD_GUEST)

**דוגמאות פקודות:**
- "הוסף משתתף dani@example.com לאירוע"
- "הזמן את dani@example.com לפגישה"

**פרמטרים:**
```json
{
  "command": "הוסף משתתף dani@example.com",
  "eventId": "event_id_123",
  "guests": ["dani@example.com", "another@example.com"]
}
```

## זיהוי תאריכים ושעות בעברית

המערכת מזהה את הפורמטים הבאים:

### תאריכים:
- **יחסיים:** "היום", "מחר", "מחרתיים"
- **ימי שבוע:** "יום ראשון", "יום שני", "שני", "רביעי", וכו'
- **מספריים:** "15/01/2024", "15.01", "15-01"
- **חודשים בעברית:** "15 בינואר", "20 במרץ"

### שעות:
- "בשעה 10:00"
- "ב-14:30"
- "בשעה 9"

## טיפול בשגיאות

כל שגיאה מחזירה:
```json
{
  "success": false,
  "message": "הסבר השגיאה בעברית"
}
```

**שגיאות נפוצות:**
- "לא זוהתה פעולה. אנא נסה שוב עם פקודה ברורה יותר."
- "האירוע לא נמצא. אנא ציין כותרת או מזהה מדויק יותר."
- "חסרה כותרת לאירוע. אנא ציין כותרת."
- "לא צוין זמן חדש להעברת האירוע."
- "צבע לא תקין. צבעים זמינים: כחול, ירוק, אדום..."

## דוגמאות שימוש מלאות

### דוגמה 1: יצירת פגישה מפורטת
```javascript
fetch('YOUR_SCRIPT_URL', {
  method: 'POST',
  body: JSON.stringify({
    command: "צור אירוע 'פגישה עם הלקוח' מחר בשעה 10:00 צבע כחול במיקום משרד תזכורת 15 דקות",
    guests: ["client@example.com"]
  })
})
```

### דוגמה 2: עדכון אירוע קיים
```javascript
fetch('YOUR_SCRIPT_URL', {
  method: 'POST',
  body: JSON.stringify({
    action: "UPDATE",
    eventId: "event_id_123",
    startTime: "2024-01-16T14:00:00.000Z",
    color: "אדום"
  })
})
```

### דוגמה 3: כתיבה חופשית בעברית
```javascript
fetch('YOUR_SCRIPT_URL', {
  method: 'POST',
  body: JSON.stringify({
    command: "הוסף פגישת צוות ביום חמישי בשעה 9 בבוקר במשרד עם תזכורת רבע שעה"
  })
})
```

## הערות חשובות

1. **פרטיות והרשאות:** המערכת מבצעת פעולות ביומן האישי של המשתמש המחובר
2. **אבטחה:** כל הפעולות מתבצעות דרך OAuth של Google
3. **שפה:** כל ההודעות והתגובות בעברית בלבד
4. **זמנים:** כל הזמנים באזור הזמן Asia/Jerusalem
5. **מזהים:** מומלץ לשמור את ה-eventId שמוחזר לשימוש עתידי

## תמיכה נוספת

לכל שאלה או בעיה, ניתן לבדוק:
- את הלוגים ב-Stackdriver
- את הרשאות ה-OAuth
- את הפורמט של הבקשות
