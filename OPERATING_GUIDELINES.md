# מדריך הפעלה – יומן חכם בעברית

## 📋 סקירה כללית
יישום PWA ליומן Google חכם עם תמיכה בעברית וממשק NLP (Natural Language Processing) לניהול אירועים.

## 🚀 התקנה והגדרה ראשונית

### שלב 1: פריסת Apps Script
1. פתח את [Google Apps Script](https://script.google.com)
2. צור פרויקט חדש
3. העתק את הקוד מ-`src/Code.gs` לעורך
4. העתק את `src/appsscript.json` (File → Project Properties → appsscript.json)
5. שמור את הפרויקט (Ctrl+S)
6. פרוס: Deploy → New deployment
   - סוג: Web app
   - הרצה בתור: המשתמש הגולש (User accessing the web app)
   - גישה: כל אחד (Anyone)
7. אשר הרשאות (תתבקש לאשר גישה ליומן Google)
8. העתק את ה-URL של ה-deployment (מסתיים ב-`/exec`)

### שלב 2: הגדרת PWA
1. פתח את `index.html` בדפדפן (או העלה לשרת סטטי/GitHub Pages)
2. הזן את ה-URL מ-Apps Script בשדה "כתובת Apps Script" בהגדרות
3. לחץ "בדיקה" כדי לוודא שהחיבור עובד
4. התקן את האפליקציה למסך הבית (כפתור "התקן")

## 🎯 יכולות מרכזיות

### 1. ניהול אירועים (CRUD)
- **יצירה (Create)**: צור אירועים חדשים
- **קריאה (Read)**: צפה באירועים קיימים
- **עדכון (Update)**: ערוך פרטי אירועים
- **מחיקה (Delete)**: מחק אירועים

### 2. NLP בעברית (v1)
המערכת מזהה פקודות בשפה עברית טבעית:

#### פקודות יצירה
```
צור פגישה עם דני מחר בשעה 14:00
הוסף תזכורת לקנות חלב היום
יצירה פגישת צוות ביום 25/12 בשעה 10:00
```

#### פקודות עדכון
```
עדכן פגישה עם דני ל 15:00
שנה תזכורת חלב למחר
```

#### פקודות מחיקה
```
מחק פגישה עם דני
הסר תזכורת חלב
בטל פגישת צוות
```

### 3. זיהוי זמנים בעברית
המערכת מזהה ביטויי זמן בעברית:
- **היום** - אירוע להיום
- **מחר** - אירוע למחר (9:00 ברירת מחדל)
- **שבוע הבא** - אירוע בעוד שבוע
- **שעה**: פורמט 24 שעות (למשל: 14:00, 09:30)
- **תאריך**: DD/MM או DD/MM/YYYY (למשל: 25/12 או 25/12/2024)

## 📚 שימוש בממשק

### עורך חכם
1. **נתח טקסט (parseOnly)**: בודק מה המערכת הבינה מהטקסט מבלי לבצע
2. **בצע פעולה**: מנתח ומבצע את הפעולה על היומן
3. **נקה**: מנקה את שדה הטקסט

### רשימת אירועים
- **רענן**: טוען מחדש את רשימת האירועים
- **היום**: מציג אירועים להיום בלבד
- **השבוע**: מציג אירועים לשבוע הקרוב
- **בדיקה**: מריץ בדיקת מערכת

### פעולות על אירועים
כל אירוע ברשימה כולל:
- **✏️ ערוך**: ממלא את שדה העריכה עם פרטי האירוע
- **🗑️ מחק**: מוחק את האירוע (לאחר אישור)

## 🔧 API ו-Backend

### Endpoints

#### doGet (legacy - תאימות לאחור)
```
GET ?mode=selftest    # בדיקת מערכת
GET ?mode=today       # אירועי היום
GET ?mode=events      # אירועים לשבוע הקרוב
```

#### doPost (JSON API)
```javascript
// בדיקת מערכת
POST { action: "selfTest" }

// חיפוש אירועים
POST { 
  action: "findEvents",
  options: {
    timeMin: "2024-01-01T00:00:00Z",  // אופציונלי
    timeMax: "2024-12-31T23:59:59Z",  // אופציונלי
    q: "פגישה",                       // חיפוש טקסט אופציונלי
    maxResults: 20                    // מספר תוצאות מקסימלי
  }
}

// יצירת אירוע
POST {
  action: "createEvent",
  options: {
    title: "פגישה חשובה",
    start: "2024-12-25T14:00:00Z",
    end: "2024-12-25T15:00:00Z",
    description: "תיאור האירוע",    // אופציונלי
    location: "משרד",                // אופציונלי
    allDay: false                     // אופציונלי
  }
}

// עדכון אירוע
POST {
  action: "updateEvent",
  options: {
    id: "EVENT_ID",
    title: "כותרת חדשה",             // אופציונלי
    description: "תיאור חדש",        // אופציונלי
    location: "מיקום חדש",           // אופציונלי
    start: "2024-12-25T15:00:00Z",   // אופציונלי
    end: "2024-12-25T16:00:00Z"      // אופציונלי
  }
}

// מחיקת אירוע
POST {
  action: "deleteEvent",
  options: { id: "EVENT_ID" }
}

// ניתוח טקסט (NLP)
POST {
  action: "parseText",
  options: {
    text: "צור פגישה מחר בשעה 14:00",
    parseOnly: false  // true = רק ניתוח, false = ניתוח + ביצוע
  }
}
```

## 🛡️ אבטחה והרשאות

### OAuth Scopes
- `calendar` - גישה מלאה ליומן (קריאה + כתיבה)
- `userinfo.email` - מזהה משתמש
- `script.external_request` - קריאות API חיצוניות

### גישה
- Web app מוגדר ל-"Anyone" אך רץ בהקשר של המשתמש הגולש
- כל משתמש רואה ומנהל את היומן האישי שלו בלבד
- נדרשת הרשאה ראשונית לגישה ליומן

## 🔄 Service Worker ו-PWA

### אסטרטגיות מטמון
- **Static assets** (HTML, CSS, manifest, icons): Cache-first
- **API calls** (`script.google.com/exec`): Network-first
- גרסת מטמון נוכחית: `yaniv-v4`

### התקנה
- Android: כפתור "Install" או "Add to Home Screen"
- iOS: Safari → Share → Add to Home Screen
- Desktop: כפתור ההתקנה בסרגל הכתובת

## 🐛 פתרון בעיות

### המערכת לא מגיבה
1. ודא שה-URL של Apps Script מוגדר נכון בהגדרות
2. לחץ "בדיקה" כדי לוודא חיבור
3. בדוק שאישרת את ההרשאות ב-Apps Script
4. נסה לרענן את הדף (F5)

### NLP לא מזהה פקודות
1. ודא שהטקסט בעברית ומכיל פועל פעולה (צור, מחק, עדכן)
2. השתמש בפורמט תאריך ברור (DD/MM או DD/MM/YYYY)
3. השתמש בפורמט שעה 24 שעות (14:00 ולא 2:00 PM)
4. השתמש ב-"נתח טקסט" כדי לראות מה המערכת הבינה

### אירועים לא נטענים
1. ודא שיש לך אירועים ביומן Google בטווח הזמנים
2. נסה "השבוע" במקום "היום" כדי לראות טווח רחב יותר
3. בדוק שיש חיבור אינטרנט פעיל

## 📖 דוגמאות לשימוש

### תרחיש 1: יצירת פגישה מהירה
```
1. הקלד: "צור פגישה עם הבוס מחר בשעה 10:00"
2. לחץ "בצע פעולה"
3. האירוע נוצר אוטומטית ביומן
```

### תרחיש 2: תזכורת יומית
```
1. הקלד: "הוסף תזכורת לקנות חלב היום"
2. לחץ "בצע פעולה"
3. התזכורת נוספת להיום
```

### תרחיש 3: מחיקת אירוע מיותר
```
אופציה 1 (ממשק):
1. מצא את האירוע ברשימה
2. לחץ "🗑️ מחק"
3. אשר את המחיקה

אופציה 2 (NLP):
1. הקלד: "מחק פגישה עם הבוס"
2. לחץ "בצע פעולה"
```

## 🚧 מגבלות ידועות

1. **NLP v1**: תמיכה בסיסית בפקודות פשוטות בעברית בלבד
2. **עדכון אירועים**: דורש זיהוי ידני של האירוע (לא תמיד אוטומטי)
3. **אירועים חוזרים**: אין תמיכה מלאה באירועים חוזרים
4. **חיפוש**: חיפוש טקסט בסיסי בכותרת ותיאור בלבד
5. **אזור זמן**: מוגדר ל-Asia/Jerusalem

## 📞 תמיכה ופיתוח עתידי

### גרסאות עתידיות (v2-draft)
- NLP מתקדם יותר עם tokenization
- תמיכה באירועים חוזרים
- חיפוש מתקדם
- תמיכה במספר לוחות שנה
- סנכרון אופליין

### תרומה לפרויקט
ראה `docs/NLP_NOTES.md` לפרטים טכניים על מנוע ה-NLP והרחבתו.

---
**גרסה**: 1.0.0  
**עדכון אחרון**: דצמבר 2024  
**תאימות**: Google Apps Script V8, PWA מודרני
