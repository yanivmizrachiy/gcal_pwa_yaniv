<!DOCTYPE html><html lang="he" dir="rtl"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>×™×•××Ÿ ×—×›× â€“ ×™× ×™×‘</title>
<link rel="manifest" href="manifest.webmanifest"><meta name="theme-color" content="#0b1220">
<style>
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Arial;background:#0b1220;color:#e7ecf5}
.wrap{max-width:900px;margin:0 auto;padding:16px}
.card{background:#101a30;border:1px solid #1e2a48;border-radius:16px;padding:14px;box-shadow:0 6px 24px rgba(0,0,0,.25);margin-bottom:12px}
.top{display:flex;align-items:center;gap:10px;justify-content:space-between;margin-bottom:8px}
button{padding:10px 14px;border-radius:12px;border:1px solid #2e4c86;background:#1b3a6b;color:#fff;font-weight:600;cursor:pointer;font-size:14px}
button:hover{background:#245091}
button:disabled{opacity:0.5;cursor:not-allowed}
button.danger{background:#8b1b1b;border-color:#6b1515}
button.danger:hover{background:#a92020}
button.success{background:#1b6b3a;border-color:#156b2e}
button.success:hover{background:#20914b}
small{color:#9fb4d9;font-size:12px}
input,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #2e4c86;background:#0d1528;color:#e7ecf5;font-family:inherit;font-size:14px;box-sizing:border-box}
textarea{min-height:80px;resize:vertical}
.form-group{margin-bottom:12px}
label{display:block;margin-bottom:6px;font-weight:600;font-size:13px}
.nlp-input{background:#1b3a6b;border:2px solid #3d5a9e;font-size:15px;font-weight:500}
.event-item{background:#0d1528;border:1px solid #223556;border-radius:10px;padding:12px;margin-bottom:10px;cursor:pointer;transition:all 0.2s}
.event-item:hover{border-color:#3d5a9e;background:#121d35}
.event-title{font-weight:700;font-size:15px;margin-bottom:6px}
.event-time{color:#9fb4d9;font-size:13px}
.event-actions{margin-top:10px;display:flex;gap:8px}
.event-actions button{padding:6px 12px;font-size:12px}
.message{padding:10px;border-radius:8px;margin-bottom:12px;font-size:14px}
.message.success{background:#1b6b3a;border:1px solid#156b2e}
.message.error{background:#8b1b1b;border:1px solid#6b1515}
.hidden{display:none}
.loading{opacity:0.6;pointer-events:none}
.tabs{display:flex;gap:8px;margin-bottom:16px;border-bottom:2px solid #1e2a48}
.tab{padding:10px 16px;background:transparent;border:none;color:#9fb4d9;cursor:pointer;font-size:14px;font-weight:600;border-bottom:2px solid transparent;margin-bottom:-2px}
.tab.active{color:#e7ecf5;border-bottom-color:#3d5a9e}
.tab:hover{color:#e7ecf5}
h2{margin:0 0 16px 0;font-size:18px;font-weight:700}
.config-note{background:#1b3a6b;padding:10px;border-radius:8px;font-size:13px;margin-bottom:12px;border:1px solid#2e4c86}
</style></head><body>
<div class="wrap">
  <div class="card"><div class="top">
    <div>×™×•××Ÿ ×—×›× ×¢× ×¢×¨×™×›×” ××ª×§×“××ª</div>
    <button id="installBtn">×”×ª×§×Ÿ</button>
  </div><small>Android: Install / Add to Home Screen Â· iOS: Add to Home Screen</small></div>

  <div class="card">
    <div class="config-note" id="configNote">
      âš™ï¸ ×œ×¤× ×™ ×©×™××•×© ×¨××©×•×Ÿ: ×¢×“×›×Ÿ ××ª ×”-SCRIPT_URL ×‘×§×•×“ JavaScript ×œ××˜×” ×¢× ×›×ª×•×‘×ª ×”-Apps Script ×©×œ×š
    </div>
    <div class="tabs">
      <button class="tab active" data-tab="nlp">×¢×‘×¨×™×ª ×—×•×¤×©×™×ª</button>
      <button class="tab" data-tab="create">×™×¦×™×¨×ª ××™×¨×•×¢</button>
      <button class="tab" data-tab="list">×¨×©×™××ª ××™×¨×•×¢×™×</button>
    </div>

    <div id="messageArea"></div>

    <!-- NLP Tab -->
    <div id="nlpTab" class="tab-content">
      <h2>×¤×§×•×“×•×ª ×‘×¢×‘×¨×™×ª</h2>
      <div class="form-group">
        <label>×”×§×œ×“ ×¤×§×•×“×” ×‘×©×¤×” ×˜×‘×¢×™×ª:</label>
        <input type="text" id="nlpInput" class="nlp-input" placeholder='×œ×“×•×’××”: "×¦×•×¨ ×¤×’×™×©×” ××—×¨ ×‘-10:00" ××• "×”×¦×’ ××™×¨×•×¢×™× ×”×™×•×"'>
      </div>
      <button id="nlpBtn" class="success">×‘×¦×¢ ×¤×§×•×“×”</button>
      <small style="display:block;margin-top:10px">×“×•×’×××•×ª: "×¦×•×¨ ×¤×’×™×©×” ×¢× ×“× ×™ ××—×¨ ×‘-14:00", "×”×¦×’ ××™×¨×•×¢×™× ×”×™×•×", "×§×‘×¢ ×¤×’×™×©×” ×”×™×•× ×‘×©×¢×” 16:30"</small>
    </div>

    <!-- Create Tab -->
    <div id="createTab" class="tab-content hidden">
      <h2>×™×¦×™×¨×ª ××™×¨×•×¢ ×—×“×©</h2>
      <form id="createForm">
        <div class="form-group">
          <label>×›×•×ª×¨×ª ×”××™×¨×•×¢:</label>
          <input type="text" id="eventTitle" required placeholder="×¤×’×™×©×” ×¢×...">
        </div>
        <div class="form-group">
          <label>×ª××¨×™×š ×•×©×¢×ª ×”×ª×—×œ×”:</label>
          <input type="datetime-local" id="eventStart" required>
        </div>
        <div class="form-group">
          <label>×ª××¨×™×š ×•×©×¢×ª ×¡×™×•×:</label>
          <input type="datetime-local" id="eventEnd" required>
        </div>
        <div class="form-group">
          <label>×ª×™××•×¨ (××•×¤×¦×™×•× ×œ×™):</label>
          <textarea id="eventDesc" placeholder="×¤×¨×˜×™× × ×•×¡×¤×™×..."></textarea>
        </div>
        <button type="submit" class="success">×¦×•×¨ ××™×¨×•×¢</button>
      </form>
    </div>

    <!-- List Tab -->
    <div id="listTab" class="tab-content hidden">
      <h2>×”××™×¨×•×¢×™× ×©×œ×š</h2>
      <div style="display:flex;gap:8px;margin-bottom:16px">
        <button id="loadTodayBtn">×”×™×•×</button>
        <button id="loadWeekBtn">×”×©×‘×•×¢</button>
        <button id="refreshBtn">×¨×¢× ×Ÿ</button>
      </div>
      <div id="eventsList"></div>
    </div>
  </div>

  <!-- Edit Modal (hidden by default) -->
  <div id="editModal" class="card hidden">
    <h2>×¢×¨×™×›×ª ××™×¨×•×¢</h2>
    <form id="editForm">
      <input type="hidden" id="editEventId">
      <div class="form-group">
        <label>×›×•×ª×¨×ª:</label>
        <input type="text" id="editTitle" required>
      </div>
      <div class="form-group">
        <label>×ª××¨×™×š ×•×©×¢×ª ×”×ª×—×œ×”:</label>
        <input type="datetime-local" id="editStart" required>
      </div>
      <div class="form-group">
        <label>×ª××¨×™×š ×•×©×¢×ª ×¡×™×•×:</label>
        <input type="datetime-local" id="editEnd" required>
      </div>
      <div class="form-group">
        <label>×ª×™××•×¨:</label>
        <textarea id="editDesc"></textarea>
      </div>
      <div style="display:flex;gap:8px">
        <button type="submit" class="success">×©××•×¨ ×©×™× ×•×™×™×</button>
        <button type="button" id="cancelEditBtn">×‘×˜×œ</button>
      </div>
    </form>
  </div>
</div>

<script>
// Configuration - UPDATE THIS URL WITH YOUR APPS SCRIPT WEB APP URL
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw_AuT9V3G6IjBTAluI9PVyVA4TNjEy9DDFg5_APSHFAnAjwoMKzieowIJDmkH1DkuL/exec';

// PWA Install
if('serviceWorker' in navigator){navigator.serviceWorker.register('./sw.js').catch(()=>{});}
let dp=null; 
window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();dp=e;});
document.getElementById('installBtn').addEventListener('click',()=>{ 
  if(dp){dp.prompt();dp=null;} else alert('×× ××™×Ÿ Install, ×‘×—×¨ Add to Home Screen');
});

// Tab Management
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    const tabName = tab.dataset.tab;
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
    document.getElementById(tabName + 'Tab').classList.remove('hidden');
    if(tabName === 'list') loadEvents();
  });
});

// Message Display
function showMessage(text, isError = false) {
  const msg = document.getElementById('messageArea');
  msg.innerHTML = `<div class="message ${isError ? 'error' : 'success'}">${text}</div>`;
  setTimeout(() => msg.innerHTML = '', 5000);
}

function setLoading(element, loading) {
  if(loading) element.classList.add('loading');
  else element.classList.remove('loading');
}

// API Calls
async function callAPI(action, params = {}) {
  const response = await fetch(SCRIPT_URL, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({action, ...params})
  });
  return await response.json();
}

// NLP Handler
document.getElementById('nlpBtn').addEventListener('click', async () => {
  const input = document.getElementById('nlpInput');
  const text = input.value.trim();
  if(!text) return;
  
  const btn = document.getElementById('nlpBtn');
  setLoading(btn, true);
  
  try {
    const result = await callAPI('text', {text});
    if(result.ok) {
      showMessage(result.message);
      input.value = '';
      if(result.events) {
        document.querySelector('.tab[data-tab="list"]').click();
      }
    } else {
      showMessage(result.message, true);
    }
  } catch(err) {
    showMessage('×©×’×™××ª ×ª×§×©×•×¨×ª: ' + err.message, true);
  } finally {
    setLoading(btn, false);
  }
});

document.getElementById('nlpInput').addEventListener('keypress', (e) => {
  if(e.key === 'Enter') document.getElementById('nlpBtn').click();
});

// Create Event Handler
document.getElementById('createForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const btn = e.target.querySelector('button[type="submit"]');
  setLoading(btn, true);
  
  try {
    const result = await callAPI('createEvent', {
      title: document.getElementById('eventTitle').value,
      startDate: new Date(document.getElementById('eventStart').value).toISOString(),
      endDate: new Date(document.getElementById('eventEnd').value).toISOString(),
      description: document.getElementById('eventDesc').value
    });
    
    if(result.ok) {
      showMessage(result.message);
      e.target.reset();
      document.querySelector('.tab[data-tab="list"]').click();
    } else {
      showMessage(result.message, true);
    }
  } catch(err) {
    showMessage('×©×’×™××ª ×ª×§×©×•×¨×ª: ' + err.message, true);
  } finally {
    setLoading(btn, false);
  }
});

// Set default datetime values
function setDefaultDateTime() {
  const now = new Date();
  now.setMinutes(0);
  const nowStr = now.toISOString().slice(0, 16);
  document.getElementById('eventStart').value = nowStr;
  now.setHours(now.getHours() + 1);
  document.getElementById('eventEnd').value = now.toISOString().slice(0, 16);
}
setDefaultDateTime();

// Load Events
async function loadEvents(startDate, endDate) {
  const list = document.getElementById('eventsList');
  list.innerHTML = '<div style="text-align:center;padding:20px;color:#9fb4d9">×˜×•×¢×Ÿ ××™×¨×•×¢×™×...</div>';
  
  try {
    const result = await callAPI('findEvents', {
      startDate: startDate ? startDate.toISOString() : undefined,
      endDate: endDate ? endDate.toISOString() : undefined
    });
    
    if(result.ok && result.events.length > 0) {
      list.innerHTML = result.events.map(ev => {
        const start = new Date(ev.start);
        const end = new Date(ev.end);
        return `
          <div class="event-item" data-id="${ev.id}">
            <div class="event-title">${ev.title}</div>
            <div class="event-time">
              ğŸ“… ${start.toLocaleDateString('he-IL')} | 
              ğŸ• ${start.toLocaleTimeString('he-IL', {hour:'2-digit',minute:'2-digit'})} - 
              ${end.toLocaleTimeString('he-IL', {hour:'2-digit',minute:'2-digit'})}
            </div>
            ${ev.description ? `<div style="margin-top:6px;font-size:13px;color:#9fb4d9">${ev.description}</div>` : ''}
            <div class="event-actions">
              <button onclick="editEvent('${ev.id}')" class="success">×¢×¨×•×š</button>
              <button onclick="deleteEvent('${ev.id}', '${ev.title.replace(/'/g, "\\'")}')" class="danger">××—×§</button>
            </div>
          </div>
        `;
      }).join('');
    } else {
      list.innerHTML = '<div style="text-align:center;padding:20px;color:#9fb4d9">××™×Ÿ ××™×¨×•×¢×™× ×‘×˜×•×•×— ×–×”</div>';
    }
  } catch(err) {
    list.innerHTML = `<div style="text-align:center;padding:20px;color:#f55">×©×’×™××”: ${err.message}</div>`;
  }
}

document.getElementById('loadTodayBtn').addEventListener('click', () => {
  const today = new Date();
  today.setHours(0,0,0,0);
  const tomorrow = new Date(today);
  tomorrow.setDate(tomorrow.getDate() + 1);
  loadEvents(today, tomorrow);
});

document.getElementById('loadWeekBtn').addEventListener('click', () => {
  const today = new Date();
  const nextWeek = new Date(today.getTime() + 7*24*60*60*1000);
  loadEvents(today, nextWeek);
});

document.getElementById('refreshBtn').addEventListener('click', () => loadEvents());

// Edit Event
async function editEvent(eventId) {
  try {
    const result = await callAPI('getEvent', {eventId});
    if(result.ok) {
      const ev = result.event;
      document.getElementById('editEventId').value = ev.id;
      document.getElementById('editTitle').value = ev.title;
      document.getElementById('editStart').value = new Date(ev.start).toISOString().slice(0, 16);
      document.getElementById('editEnd').value = new Date(ev.end).toISOString().slice(0, 16);
      document.getElementById('editDesc').value = ev.description || '';
      document.getElementById('editModal').classList.remove('hidden');
      window.scrollTo(0, document.getElementById('editModal').offsetTop);
    } else {
      showMessage(result.message, true);
    }
  } catch(err) {
    showMessage('×©×’×™××”: ' + err.message, true);
  }
}

document.getElementById('editForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const btn = e.target.querySelector('button[type="submit"]');
  setLoading(btn, true);
  
  try {
    const result = await callAPI('updateEvent', {
      eventId: document.getElementById('editEventId').value,
      title: document.getElementById('editTitle').value,
      startDate: new Date(document.getElementById('editStart').value).toISOString(),
      endDate: new Date(document.getElementById('editEnd').value).toISOString(),
      description: document.getElementById('editDesc').value
    });
    
    if(result.ok) {
      showMessage(result.message);
      document.getElementById('editModal').classList.add('hidden');
      loadEvents();
    } else {
      showMessage(result.message, true);
    }
  } catch(err) {
    showMessage('×©×’×™××ª ×ª×§×©×•×¨×ª: ' + err.message, true);
  } finally {
    setLoading(btn, false);
  }
});

document.getElementById('cancelEditBtn').addEventListener('click', () => {
  document.getElementById('editModal').classList.add('hidden');
});

// Delete Event
async function deleteEvent(eventId, title) {
  if(!confirm(`×”×× ×œ××—×•×§ ××ª "${title}"?`)) return;
  
  try {
    const result = await callAPI('deleteEvent', {eventId});
    if(result.ok) {
      showMessage(result.message);
      loadEvents();
    } else {
      showMessage(result.message, true);
    }
  } catch(err) {
    showMessage('×©×’×™××”: ' + err.message, true);
  }
}
</script>
</body></html>
